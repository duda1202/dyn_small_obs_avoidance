# dyn_small_obs_avoidance

## Params
Common:

`~map_frame` (`string`, default: `map`)

SLAM map reference frame, ENU convention.

`~uav_frame` (`string`, default: `base_link`)

UAV body frame, forward-left-up convention.

### Feature extract for mapping
Takes raw pointcloud and does basic pre-processing, publishes 3 processed pointclouds for mapping consumption. (TODO: Some of these params likely dont need to be exposed.)

`~blind` (`double`, default: `0.5`)

Radius of the circle around the LiDAR to ignore (units same as LiDAR pointcloud).

`~inf_bound` (`double`, default: `10.0`)

? Ignore points past this boundary.

`~N_SCANS` (`int`, default: `6`)

Number of LIDAR scans. AVIA default is 6, VLP16 is 16.

`~group_size` (`int`, default: `8`)

`~disA` (`double`, default: `0.01`)

`~disB` (`double`, default: `0.1`)

`~p2l_ratio` (`double`, default: `225.0`)

`~limit_maxmid` (`double`, default: `6.25`)

`~limit_midmin` (`double`, default: `6.25`)

`~limit_maxmin` (`double`, default: `3.24`)

`~jump_up_limit` (`double`, default: `170.0`)

`~jump_down_limit` (`double`, default: `8.0`)

`~cos160` (`double`, default: `160.0`)

`~edgea` (`double`, default: `2.0`)

`~edgeb` (`double`, default: `0.1`)

`~smallp_intersect` (`double`, default: `172.5`)

`~smallp_ratio` (`double`, default: `1.2`)

`~point_filter_num` (`int`, default: `1`)

### FAST-LIO mapping
Takes processed pointcloud and produces registered pointcloud. (TODO: Some of these params likely dont need to be exposed.)

`~proc_cloud_topic` (`string`, default: `/laser_cloud_flat`)

Topic to subscribe, produced by feature extract for use in map creation.

`~reg_cloud_topic` (`string`, default: `/cloud_registered`)

Topic to publish resulting registered cloud.

`~imu_topic` (`string`, default: `/mavros/imu/data`)

Topic to subscribe for IMU data.

`~odom_topic` (`string`, default: `/mavros/odometry/out`)

Topic to publish odom data registered to map.

`~map_file_path` (`string`, default: ` `)

`~max_iteration` (`int`, default: `10`)

`~dense_map_enable` (`bool`, default: `true`)

`~fov_degree` (`double`, default: `75.0`)

`~filter_size_corner` (`double`, default: `0.3`)

`~filter_size_surf` (`double`, default: `0.2`)

`~filter_size_map` (`double`, default: `0.2`)

`~cube_side_length` (`double`, default: `20.0`)

### Path-planning
Plans paths through map produced by the SLAM node (FAST LIO package), where the map is in pointcloud form. Essentially a wrapper for path-searching node.

`~cloud_topic` (`string`, default: `/cloud_registered`)

Referenced pointcloud, generated by SLAM node.

`~odom_topic` (`string`, default: `/mavros/odometry/out`)

Topic to publish odometry.

### Path-searching
Uses kinodynamic A* search. An instance of path search is created by the path planning node.

`~max_tau` (`double`, default: `0.6`)

`~init_max_tau` (`double`, default: `0.8`)

`~max_vel` (`double`, default: `2.0`)

`~max_acc` (`double`, default: `2.0`)

`~w_time` (`double`, default: `10.0`)

`~horizon` (`double`, default: `100.0`)

`~resolution_astar` (`double`, default: `0.1`)

`~time_resolution` (`double`, default: `0.8`)

`~lambda_heu` (`double`, default: `5.0`)

`~vel_margin` (`double`, default: `0.0`)

`~allocate_num` (`int`, default: `100000`)

`~check_num` (`int`, default: `1`)

`~optimistic` (`bool`, default: `true`)

## Acknowledgments/Original Repo
This repo was forked from https://github.com/hku-mars/dyn_small_obs_avoidance.git which states the following:
This repository is used for UAV dynamic small obstacles avoidance. It is a complete system for lidar-based UAV, including FAST-LIO slam, time-accumulated KD-Tree mapping and kinodynamic A* search modules. It is able to avoid dynamic small obstacles (down to 20mm diameter bars) by running at 50Hz.

![RAL_coverfigure6](https://user-images.githubusercontent.com/23183555/109411264-d39ccf00-79db-11eb-85d3-764a6b17235d.png)

![outdoor2_movingobs](https://user-images.githubusercontent.com/23183555/109411282-f202ca80-79db-11eb-8ae0-704bda25ff12.png)

Related paper:
"Avoiding dynamic small obstacles with onboard sensing and computating on aerial robots", 
available on arxiv now https://arxiv.org/abs/2103.00406.

Related video:
https://youtu.be/pBHbQ_J1Qhc

Thanks for FAST-PLANNER(Zhou, Boyu and Gao, Fei and Wang, Luqi and Liu, Chuhao and Shen, Shaojie. Robust and efficient quadrotor trajectory generation for fast autonomous flight), [FAST-PLANNER](https://github.com/HKUST-Aerial-Robotics/Fast-Planner.git).
